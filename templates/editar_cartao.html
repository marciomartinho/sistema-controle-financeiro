{% extends 'base.html' %}

{% block content %}
<h2>Editar Cartão de Crédito: {{ cartao.nome }}</h2>
<hr>

<div class="card bg-light">
    <div class="card-body">
        <form method="POST" action="{{ url_for('cartoes_bp.editar_cartao', id=cartao.id) }}" enctype="multipart/form-data">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="nome" class="form-label">Nome do Cartão</label>
                    <input type="text" class="form-control" id="nome" name="nome" value="{{ cartao.nome }}" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="dia_vencimento" class="form-label">Dia de Vencimento</label>
                    <input type="number" class="form-control" id="dia_vencimento" name="dia_vencimento" 
                           min="1" max="31" value="{{ cartao.dia_vencimento }}" required>
                    <small class="form-text text-muted">Dia do mês em que a fatura vence</small>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="conta_pagamento_id" class="form-label">Conta para Pagamento</label>
                    <select class="form-select" id="conta_pagamento_id" name="conta_pagamento_id">
                        <option value="">Nenhuma conta selecionada</option>
                        {% for conta in contas %}
                            <option value="{{ conta.id }}" {% if cartao.conta_pagamento_id == conta.id %}selected{% endif %}>
                                {{ conta.nome }}
                            </option>
                        {% endfor %}
                    </select>
                    <small class="form-text text-muted">Conta que será debitada no pagamento da fatura</small>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="logo_imagem" class="form-label">Alterar Logo (opcional)</label>
                    <input class="form-control" type="file" id="logo_imagem" name="logo_imagem" accept="image/*">
                    {% if cartao.logo_imagem %}
                        <small class="text-muted">Logo atual: {{ cartao.logo_imagem }}</small>
                    {% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    {% if cartao.logo_imagem %}
                        <label class="form-label">Logo Atual</label>
                        <div>
                            <img src="{{ url_for('static', filename='uploads/' + cartao.logo_imagem) }}" 
                                 alt="Logo atual" 
                                 class="img-thumbnail" 
                                 style="max-width: 100px; border-radius: 8px;">
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="row">
                <div class="col-md-12 mb-3">
                    <div class="alert alert-info">
                        <small>
                            <strong>Informações do cartão:</strong><br>
                            <i class="bi bi-calendar-event"></i> Criado em: {{ cartao.data_criacao.strftime('%d/%m/%Y') }}<br>
                            <i class="bi bi-circle-fill {% if cartao.ativo %}text-success{% else %}text-secondary{% endif %}"></i> 
                            Status: {% if cartao.ativo %}Ativo{% else %}Inativo{% endif %}<br>
                            <i class="bi bi-bank"></i> Conta atual: 
                            {% if cartao.conta_pagamento %}
                                {{ cartao.conta_pagamento.nome }}
                            {% else %}
                                <span class="text-warning">Nenhuma conta vinculada</span>
                            {% endif %}
                        </small>
                    </div>
                </div>
            </div>

            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-check-lg"></i> Salvar Alterações
                </button>
                <a href="{{ url_for('cartoes_bp.gerenciar_cartoes') }}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> Cancelar
                </a>
            </div>
        </form>
    </div>
</div>

<div class="mt-4">
    <div class="alert alert-warning">
        <h6><i class="bi bi-exclamation-triangle-fill"></i> Atenção!</h6>
        <p class="mb-0">
            Alterar o dia de vencimento afetará as futuras faturas geradas automaticamente. 
            Lançamentos já existentes não serão alterados.
        </p>
    </div>
</div>
{% endblock %}